<soda>
    
    <!-- auto updating calculated field that contain count function when related record changed -->
    <puts text="Test: Studio_11678.xml starting" />
        
     <!-- set description field as calculated field and define formula -->
    <timestamp />
    <link text="Admin" />
    <link text="Studio" assertPage="false" />
    <link text="Contacts" class="studiolink" assertPage="false" />
    <link text="Fields" class="studiolink" assertPage="false" />
    <link text="description" class="mbLBLL" assertPage="false" />
    <checkbox id="calculated" set="true" />
    <wait timeout="1" />
    <button value="Edit Formula" />
    <wait timeout="3" />
    <browser assert="Formula Builder" />
    <div id="formulaBuilderWindow" >
      <textfield id="formulaInput" set="count($calls)"/>
      <button id="fomulaSaveButton" />
    </div>
    <wait timeout="3" />
    <form id="popup_form_id" >
      <button name="fsavebtn" assertPage="false" />
    </form>
    <wait timeout="10" />
    <browser assert="Add Field" />
    
    <!--create account record and calls-->
    <script file="{@global.scriptsdir}/modules/lib/Contact_Create_Lib_MIN.xml" />       
    <csv file="{@global.scriptsdir}/csvs/studio/Studio_11678.csv" var="studio11678">
   		<script file="{@global.scriptsdir}/modules/lib/Call_Create_Lib.xml" />
    	<button id="edit_button" />
    	<form id="EditView">
    		<select id="parent_type" set="Contacts" />
    		<button id="btn_parent_name" /> 
    	</form>   	
			<browser assert="Contact Search" />
			<link text="{@pre_contact_first_name} {@pre_contact_last_name}"/>
			<button value="Save" />
    	  	
    	<table id="detailpanel_1">
    		<browser assert="{@pre_call_name}" />
        	<browser assert="{@pre_contact_first_name} {@pre_contact_last_name}" />
      	</table>  	
    </csv>
    <link id="moduleTab_Contacts" />
	<textfield id="search_name_basic" set="{@pre_contact_first_name}" />
	<button id="search_form_submit" />
	<table class="list view">
		<link text="{@pre_contact_first_name} {@pre_contact_last_name}" />
	</table>
	<div id ="LBL_CONTACT_INFORMATION">
		<browser assert="{@pre_contact_first_name} {@pre_contact_last_name}" />
	</div>
	<button id="edit_button" />
	<wait timeout="10" />
	<textfield id="description" assert="{@studio11678.count1}" />
	<button id="SAVE_HEADER" />
	<div id="LBL_CONTACT_INFORMATION">
		<browser assert="{@pre_contact_first_name} {@pre_contact_last_name}" />
    	<span id="description" assert="{@studio11678.count1}" />
  	</div>    
    
    <!-- change the related record-->    
	<link id='moduleTab_Calls'/>
	<textfield id="name_basic" set="{@pre_call_name}" />
	<button id="search_form_submit" />
	<table class="list view">
		<link text="{@pre_call_name}" />
	</table>
	<div id="LBL_CALL_INFORMATION">
		<browser assert="{@pre_call_name}" />
    </div>  
	<button id="edit_button" />	
	<div id="EditView_tabs">
		<select id="parent_type" set="Accounts" />
	</div>
	<table id="schedulerTable">
		<link class="listViewTdToolsS1" index="2" />
	</table>	
	<button value="Save" />
	<table id="detailpanel_1">
		<browser assert="{@pre_call_name}" />
    	<browser assertnot="{@pre_contact_first_name} {@pre_contact_last_name}" />
  	</table>  	
  	<div id="list_subpanel_contacts">
  		<browser assertnot="{@pre_contact_first_name} {@pre_contact_last_name}" />
  	</div>
    	
	<!-- check the calculation result -->
	<link id="moduleTab_Contacts" />
	<textfield id="search_name_basic" set="{@pre_contact_first_name}" />
	<button id="search_form_submit" />
	<table class="list view">
		<link text="{@pre_contact_first_name} {@pre_contact_last_name}" />
	</table>
	<div id ="LBL_CONTACT_INFORMATION">
		<browser assert="{@pre_contact_first_name} {@pre_contact_last_name}" />
	</div>
	<button id="edit_button" />
	<wait timeout="10" />
	<textfield id="description" assert="{@studio11678.count2}" />
	<button id="SAVE_HEADER" />
	<div id="LBL_CONTACT_INFORMATION">
		<browser assert="{@pre_contact_first_name} {@pre_contact_last_name}" />
    	<span id="description" assert="{@studio11678.count2}" />
  	</div>    
    
    
    <!-- Now uncalculated the field -->
    <link text="Admin" />
    <link text="Studio" assertPage="false" />
    <link text="Contacts" class="studiolink" assertPage="false" />
    <link text="Fields" class="studiolink" assertPage="false" />
    <link text="description" class="mbLBLL" assertPage="false" />
    <checkbox id="calculated" set="false" />
    <form id="popup_form_id" >
      <browser assertnot="Formula Builder" />
      <button name="fsavebtn" assertPage="false" />
    </form>
    <wait timeout="3" />
    
    <!-- Delete account record -->
    <script file="{@global.scriptsdir}/modules/lib/Contact_Delete_Lib.xml" />
    <script file="{@global.scriptsdir}/modules/lib/Call_Delete_Lib.xml" />
    
    <puts text="Test: Studio_11678.xml finished." />
</soda>
